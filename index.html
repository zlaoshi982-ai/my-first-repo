<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>NESO â†’ NXPC â†’ äººæ°‘å¸ è®¡ç®—å™¨</title>
<style>
  :root{--bg:#f6f7fb;--card:#fff;--text:#111827;--muted:#6b7280;--line:#e5e7eb;--blue:#2563eb;--green:#16a34a;--red:#ef4444}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);
    font:16px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",Arial,sans-serif}
  .wrap{max-width:920px;margin:24px auto;padding:0 16px}
  h1{font-size:22px;margin:0 0 6px} .sub{color:var(--muted);font-size:13px;margin-bottom:16px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,.05);margin-bottom:16px}
  label{font-weight:600;display:block;margin:10px 0 6px}
  input[type=number],select,button{width:100%;padding:12px;border:1px solid var(--line);border-radius:10px;font-size:16px;background:#fff}
  input:focus,select:focus{outline:none;border-color:var(--blue)}
  .row{display:grid;gap:12px;grid-template-columns:1fr 1fr}
  @media (max-width:640px){.row{grid-template-columns:1fr}}
  .btn{cursor:pointer;font-weight:700} .btn.primary{background:var(--blue);color:#fff;border-color:var(--blue)}
  .btn.ghost{background:#fff}
  .muted{color:var(--muted);font-size:12px}
  .result{border:1px dashed var(--line);border-radius:12px;background:#fafbfc;padding:12px;margin-top:10px}
  .kpi{font-size:20px;font-weight:800;color:var(--green)}
  .mono{font-variant-numeric:tabular-nums}
  .err{color:var(--red);font-weight:700}
  .grid-3{display:grid;gap:16px;grid-template-columns:1fr 1fr 1fr}
  @media (max-width:920px){.grid-3{grid-template-columns:1fr}}
  .radio-row{display:flex;gap:14px;align-items:center;flex-wrap:wrap}
  .radio-row label{font-weight:500;margin:0;display:flex;align-items:center;gap:6px}
</style>
</head>
<body>
<div class="wrap">
  <h1>NESO â†’ NXPC â†’ äººæ°‘å¸ è®¡ç®—å™¨</h1>
  <div class="sub">å›ºå®šè§„åˆ™ï¼š<b>100,000 NESO = 1 NXPC</b> Â· å¯é€‰è‡ªåŠ¨è·å–ï¼ˆå¸å®‰/æ¬§æ˜“ï¼‰æˆ–æ‰‹åŠ¨è¾“å…¥ NXPC/USDT Â· USDTâ†’CNY æ‰‹åŠ¨å¯è®¾</div>

  <!-- è¾“å…¥ä¸è®¾ç½® -->
  <div class="card">
    <label for="neso">ğŸ”¹ è¾“å…¥ NESO æ•°é‡</label>
    <input id="neso" type="number" inputmode="numeric" placeholder="ä¾‹å¦‚ï¼š1000000ï¼ˆå›è½¦å¯è®¡ç®—ï¼‰">

    <div class="radio-row" style="margin:10px 0 6px">
      <label><input type="radio" name="mode" value="auto" checked> è‡ªåŠ¨è·å– NXPC/USDT</label>
      <label><input type="radio" name="mode" value="manual"> æ‰‹åŠ¨è¾“å…¥ NXPC/USDT</label>
    </div>

    <div id="autoBox" class="row">
      <div>
        <label for="exchange">äº¤æ˜“æ‰€ï¼ˆè‡ªåŠ¨ï¼‰</label>
        <select id="exchange">
          <option value="binance">å¸å®‰ (Binance)</option>
          <option value="okx">æ¬§æ˜“ (OKX)</option>
        </select>
      </div>
      <div>
        <label>çŠ¶æ€</label>
        <input id="autoStatus" disabled placeholder="æœªè·å–">
      </div>
    </div>

    <div id="manualBox" class="row" style="display:none">
      <div>
        <label for="nxpcUsdt">æ‰‹åŠ¨ï¼šNXPC/USDT ä»·æ ¼</label>
        <input id="nxpcUsdt" type="number" step="0.0000001" placeholder="ä¾‹å¦‚ï¼š0.7352">
      </div>
      <div>
        <label class="muted" style="margin-top:34px">ä»…æ‰‹åŠ¨æ¨¡å¼ä½¿ç”¨</label>
      </div>
    </div>

    <div class="row">
      <div>
        <label for="usdtCny">USDT â†’ CNY æ±‡ç‡ï¼ˆæ‰‹åŠ¨ï¼‰</label>
        <input id="usdtCny" type="number" step="0.0001" placeholder="ä¾‹å¦‚ï¼š7.18ï¼ˆå°†è‡ªåŠ¨è®°ä½ï¼‰">
      </div>
      <div>
        <label class="muted" style="margin-top:34px">è¯´æ˜ï¼šUSDTâ‰ˆUSDï¼Œå»ºè®®æŒ‰é“¶è¡Œ/å¹³å°è¡Œæƒ…æ›´æ–°</label>
      </div>
    </div>

    <div class="row">
      <button id="btnCalc" class="btn primary">è®¡ç®— / åˆ·æ–°</button>
      <button id="btnClear" class="btn ghost">æ¸…ç©º</button>
    </div>
    <div id="err" class="err" style="display:none"></div>
    <div class="muted">æç¤ºï¼šæŒ‰ Enter/å›è½¦ ä¹Ÿå¯è§¦å‘è®¡ç®—ï¼›è®¾ç½®ä¼šä¿å­˜åœ¨æœ¬åœ°ã€‚</div>
  </div>

  <!-- ç»“æœä¸‰æ­¥å¡ç‰‡ -->
  <div class="grid-3">
    <div class="card">
      <h3>â‘  NESO â†’ NXPC</h3>
      <div class="result mono" id="step1">
        NESOï¼šâ€”<br> æ¯”ç‡ï¼š100,000 NESO = 1 NXPC<br>
        NXPCï¼šâ€”
      </div>
    </div>

    <div class="card">
      <h3>â‘¡ NXPC â†’ USDT</h3>
      <div class="muted" id="src">æ¥æºï¼šâ€”</div>
      <div class="result mono" id="step2">
        NXPCï¼šâ€” Ã— ä»·æ ¼ï¼šâ€” USDT/NXPC<br>
        USDTï¼šâ€”
      </div>
    </div>

    <div class="card">
      <h3>â‘¢ USDT â†’ äººæ°‘å¸</h3>
      <div class="muted">USDT/CNYï¼š<span id="fxShow">â€”</span> Â· æ›´æ–°æ—¶é—´ï¼š<span id="tss">â€”</span></div>
      <div class="result mono" id="step3">
        USDTï¼šâ€” Ã— æ±‡ç‡ï¼šâ€” CNY/USDT<br>
        <div class="kpi">æ€»é‡‘é¢ï¼š<span id="rmb">â€”</span> RMB</div>
      </div>
    </div>
  </div>
</div>

<script>
  // å¸¸é‡
  const RATIO = 100000; // 100,000 NESO = 1 NXPC

  // DOM
  const $ = s => document.querySelector(s);
  const nesoEl = $('#neso');
  const modeEls = document.getElementsByName('mode');
  const autoBox = $('#autoBox'), manualBox = $('#manualBox');
  const exSel = $('#exchange'), autoStatus = $('#autoStatus');
  const nxpcUsdtEl = $('#nxpcUsdt');
  const usdtCnyEl = $('#usdtCny');
  const btnCalc = $('#btnCalc'), btnClear = $('#btnClear');
  const errEl = $('#err');

  const step1 = $('#step1'), step2 = $('#step2'), step3 = $('#step3');
  const srcEl = $('#src'), fxShow = $('#fxShow'), tss = $('#tss'), rmbEl = $('#rmb');

  // æœ¬åœ°è®°å¿†
  (function loadSaved(){
    const s = k => localStorage.getItem(k);
    if (s('nxpc_mode')) setMode(s('nxpc_mode'));
    if (s('nxpc_ex')) exSel.value = s('nxpc_ex');
    if (s('nxpc_pair')) nxpcUsdtEl.value = s('nxpc_pair');
    if (s('nxpc_fx')) usdtCnyEl.value = s('nxpc_fx');
  })();

  function saveSettings(){
    localStorage.setItem('nxpc_mode', getMode());
    localStorage.setItem('nxpc_ex', exSel.value);
    localStorage.setItem('nxpc_pair', nxpcUsdtEl.value || '');
    localStorage.setItem('nxpc_fx', usdtCnyEl.value || '');
  }

  // æ¨¡å¼åˆ‡æ¢
  function getMode(){ return [...modeEls].find(x=>x.checked).value }
  function setMode(v){
    [...modeEls].forEach(x=>x.checked = (x.value===v));
    autoBox.style.display = v==='auto' ? '' : 'none';
    manualBox.style.display = v==='manual' ? '' : 'none';
  }
  [...modeEls].forEach(x=>x.addEventListener('change', ()=>setMode(getMode())));
  [exSel, nxpcUsdtEl, usdtCnyEl].forEach(el=>el.addEventListener('input', saveSettings));

  // å›è½¦è§¦å‘è®¡ç®—
  document.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); calculate(); } });

  // ä¸»æµç¨‹
  btnCalc.addEventListener('click', calculate);
  btnClear.addEventListener('click', clearAll);

  async function calculate(){
    hideErr();
    const neso = Number(nesoEl.value);
    if (!(neso>0)){ return showErr('è¯·è¾“å…¥æœ‰æ•ˆçš„ NESO æ•°é‡'); }

    // Step 1: NESO -> NXPC
    const nxpc = neso / RATIO;
    step1.innerHTML = `
      NESOï¼š${fmt(neso)}<br>
      æ¯”ç‡ï¼š100,000 NESO = 1 NXPC<br>
      NXPCï¼š<b>${fmt(nxpc,6)}</b>
    `;

    // Step 2: NXPC -> USDT
    let pair = null, sourceText = 'â€”';
    const mode = getMode();
    if (mode==='auto'){
      autoStatus.value = 'è·å–ä¸­â€¦';
      try{
        pair = await fetchPair(exSel.value);
        if (!Number.isFinite(pair)) throw new Error('ä»·å·®å¼‚å¸¸');
        sourceText = `è‡ªåŠ¨ Â· ${exSel.value==='binance'?'å¸å®‰ Binance':'æ¬§æ˜“ OKX'} Â· 1 NXPC = ${fmt(pair,6)} USDT`;
        autoStatus.value = `æˆåŠŸï¼š${fmt(pair,6)} USDT`;
      }catch(e){
        autoStatus.value = 'å¤±è´¥ï¼Œè¯·åˆ‡æ¢äº¤æ˜“æ‰€æˆ–æ”¹ç”¨æ‰‹åŠ¨';
        return showErr('è‡ªåŠ¨è·å–ä»·æ ¼å¤±è´¥ï¼Œå¯åˆ‡æ¢äº¤æ˜“æ‰€æˆ–æ”¹ç”¨æ‰‹åŠ¨æ¨¡å¼');
      }
    }else{
      pair = Number(nxpcUsdtEl.value);
      if (!(pair>0)) return showErr('è¯·è¾“å…¥æ‰‹åŠ¨ NXPC/USDT ä»·æ ¼');
      sourceText = `æ‰‹åŠ¨ Â· 1 NXPC = ${fmt(pair,6)} USDT`;
    }
    const usdt = nxpc * pair;
    srcEl.textContent = 'æ¥æºï¼š' + sourceText;
    step2.innerHTML = `
      NXPCï¼š${fmt(nxpc,6)} Ã— ä»·æ ¼ï¼š${fmt(pair,6)} USDT/NXPC<br>
      USDTï¼š<b>${fmt(usdt,6)}</b>
    `;

    // Step 3: USDT -> CNYï¼ˆæ‰‹åŠ¨ï¼‰
    const fx = Number(usdtCnyEl.value);
    if (!(fx>0)) return showErr('è¯·å¡«å†™ USDTâ†’CNY æ±‡ç‡ï¼ˆæ‰‹åŠ¨ï¼‰');
    const cny = usdt * fx;
    fxShow.textContent = fmt(fx,4);
    tss.textContent = new Date().toLocaleString();
    step3.innerHTML = `
      USDTï¼š${fmt(usdt,6)} Ã— æ±‡ç‡ï¼š${fmt(fx,4)} CNY/USDT<br>
      <div class="kpi">æ€»é‡‘é¢ï¼š<span>${fmt(cny,2)}</span> RMB</div>
    `;

    // ä¿å­˜è®¾ç½®
    saveSettings();
  }

  function clearAll(){
    nesoEl.value='';
    // ä¿ç•™æ‰‹åŠ¨æ±‡ç‡ä¸æ‰‹åŠ¨ä»·ï¼Œæ¸…ç©ºçŠ¶æ€ä¸ç»“æœ
    autoStatus.value='æœªè·å–';
    srcEl.textContent='æ¥æºï¼šâ€”'; fxShow.textContent='â€”'; tss.textContent='â€”'; rmbEl.textContent='â€”';
    step1.innerHTML='NESOï¼šâ€”<br> æ¯”ç‡ï¼š100,000 NESO = 1 NXPC<br> NXPCï¼šâ€”';
    step2.innerHTML='NXPCï¼šâ€” Ã— ä»·æ ¼ï¼šâ€” USDT/NXPC<br> USDTï¼šâ€”';
    step3.innerHTML='USDTï¼šâ€” Ã— æ±‡ç‡ï¼šâ€” CNY/USDT<br><div class="kpi">æ€»é‡‘é¢ï¼š<span>â€”</span> RMB</div>';
    hideErr();
  }

  function showErr(msg){ errEl.style.display='block'; errEl.textContent=msg; }
  function hideErr(){ errEl.style.display='none'; errEl.textContent=''; }

  async function fetchPair(ex){
    if (ex==='binance'){
      const r = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=NXPCUSDT',{cache:'no-store'});
      const j = await r.json(); return Number(j.price);
    }else{
      const r = await fetch('https://www.okx.com/api/v5/market/ticker?instId=NXPC-USDT',{cache:'no-store'});
      const j = await r.json(); return Number(j?.data?.[0]?.last);
    }
  }

  // å·¥å…·
  const fmt = (n, d=null) => Number.isFinite(n) ? (d==null ? n.toLocaleString('zh-CN') : Number(n).toFixed(d)) : 'â€”';
</script>
</body>
</html>